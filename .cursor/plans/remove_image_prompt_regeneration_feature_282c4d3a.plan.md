---
name: Remove Image Prompt Regeneration Feature
overview: Remove the "New Idea" / regenerate image prompt feature entirely. Users will only have the 3 prompts automatically generated by the Firestore trigger. This simplifies the UI/UX and aligns with future pricing tier plans where prompt count will be controlled by subscription level.
todos:
  - id: remove_backend_endpoint
    content: Remove /regenerate-image-prompt endpoint from functions/src/index.ts
    status: pending
  - id: remove_frontend_service
    content: Remove regenerateImagePrompt function from src/services/geminiService.ts
    status: pending
  - id: remove_state_and_handlers
    content: Remove isGeneratingNewIdea state, ref, and handleNewIdea function from SlideCard.tsx
    status: pending
  - id: remove_ui_buttons
    content: Remove 'New Idea' buttons from SlideCard.tsx UI
    status: pending
  - id: clean_imports
    content: Remove regenerateImagePrompt from imports in SlideCard.tsx
    status: pending
  - id: clean_disabled_states
    content: Remove all isGeneratingNewIdea references from disabled conditions in SlideCard.tsx
    status: pending
---

# Remove Image Prompt Regeneration Feature

## Overview

Remove the ability for users to generate additional image prompts beyond the initial 3 that are automatically created. This simplifies the UI/UX and prepares for future pricing tiers where prompt count will be subscription-based rather than user-initiated.

## What Gets Removed

1. **Backend endpoint** - `/regenerate-image-prompt` route
2. **Frontend service function** - `regenerateImagePrompt()` in geminiService.ts
3. **UI components** - "New Idea" buttons and related handlers
4. **State management** - `isGeneratingNewIdea` state and refs

## What Stays

- `generateImagePrompts()` function (used by Firestore trigger)
- Firestore trigger `onSlideCreated` (generates initial 3 prompts)
- Prompt editing functionality (users can still edit existing prompts)
- Prompt selection UI (users can still switch between the 3 generated prompts)

## Implementation Steps

### Phase 1: Remove Backend Endpoint

#### 1.1 Remove Regenerate Endpoint

**File:** [`functions/src/index.ts`](functions/src/index.ts)

- Remove the entire `/regenerate-image-prompt` endpoint route (lines 161-244)
- This includes:
- The `app.post('/regenerate-image-prompt', ...)` handler
- All related logic for fetching project/slide data
- The call to `generateImagePrompts()`
- The Firestore update logic
- The cost tracking

**Note:** Keep the `generateImagePrompts()` import since it's still used by the Firestore trigger.

### Phase 2: Remove Frontend Service Function

#### 2.1 Remove regenerateImagePrompt Function

**File:** [`src/services/geminiService.ts`](src/services/geminiService.ts)

- Remove the `regenerateImagePrompt()` function (lines 231-242)
- Remove the function comment/docstring
- Keep all other functions intact

### Phase 3: Remove UI Components and State

#### 3.1 Remove State and Refs

**File:** [`src/components/SlideCard.tsx`](src/components/SlideCard.tsx)

- Remove `isGeneratingNewIdea` state declaration (line 48)
- Remove `isGeneratingNewIdeaRef` ref declaration (line 77)
- Remove the `handleNewIdea` function (lines 191-207)

#### 3.2 Remove Import

**File:** [`src/components/SlideCard.tsx`](src/components/SlideCard.tsx)

- Remove `regenerateImagePrompt` from the import statement (line 4)
- Change from: `import { generateImageFromPrompt, regenerateImagePrompt, incrementProjectTokens } from '../services/geminiService';`
- To: `import { generateImageFromPrompt, incrementProjectTokens } from '../services/geminiService';`

#### 3.3 Remove "New Idea" Buttons

**File:** [`src/components/SlideCard.tsx`](src/components/SlideCard.tsx)

- Remove the "New Idea" button from the prompt actions area (lines 338-351)
- This is the button next to the "Edit" button in the prompt header
- Remove the "Generate a New Idea" button from the empty state (lines 361-367)
- This appears when `!imagePromptText && !isEditingPrompt`
- Update the empty state message to be more informative since users can't generate new prompts
- Change from: "No image prompt generated for this slide yet."
- To: "Image prompts are being generated. Please wait a moment..."

#### 3.4 Clean Up Disabled States

**File:** [`src/components/SlideCard.tsx`](src/components/SlideCard.tsx)

- Remove all references to `isGeneratingNewIdea` in disabled conditions
- Update the "Edit" button disabled condition (line 332) to remove `isGeneratingNewIdea`
- Update prompt selection dots disabled condition (line 314) to remove `isGeneratingNewIdea`
- Update any other disabled states that reference `isGeneratingNewIdea`

**Search for all occurrences:**

- `disabled={isGeneratingNewIdea}`
- `disabled={isGeneratingNewIdea || ...}`
- `disabled={... || isGeneratingNewIdea}`

### Phase 4: Update Empty State UI

#### 4.1 Improve Empty State Message

**File:** [`src/components/SlideCard.tsx`](src/components/SlideCard.tsx)When `imagePrompts.length === 0`, the UI already shows "Generating Image Ideas..." (line 293). This is good and should remain.However, if prompts fail to generate and the array stays empty, consider:

- Keep the loading state message as-is (it's already appropriate)
- Or add a subtle message: "Waiting for image prompts to be generated..."

**Current behavior is acceptable** - the loading indicator already handles this case.

## Files to Modify

1. [`functions/src/index.ts`](functions/src/index.ts) - Remove `/regenerate-image-prompt` endpoint
2. [`src/services/geminiService.ts`](src/services/geminiService.ts) - Remove `regenerateImagePrompt()` function
3. [`src/components/SlideCard.tsx`](src/components/SlideCard.tsx) - Remove state, handlers, buttons, and clean up imports

## Verification Checklist

- [ ] Backend endpoint removed (no `/regenerate-image-prompt` route)
- [ ] Frontend service function removed
- [ ] "New Idea" buttons removed from UI
- [ ] `handleNewIdea` function removed
- [ ] `isGeneratingNewIdea` state and ref removed
- [ ] Import cleaned up (no `regenerateImagePrompt` import)
- [ ] All disabled states updated (no references to `isGeneratingNewIdea`)
- [ ] Empty state still shows loading indicator appropriately
- [ ] Firestore trigger still works (generates initial 3 prompts)
- [ ] Prompt editing still works
- [ ] Prompt selection (switching between prompts) still works

## Notes

- The `generateImagePrompts()` function in `imageGeneration.ts` is **kept** because it's used by the Firestore trigger
- Users can still edit existing prompts manually
- Users can still switch between the 3 automatically generated prompts